#!/usr/bin/env node
'use strict';

// Downloads Pok√©mon Showdown's "minidexes" which contain animated sprite size and index
// information and then generates a combined JSON file with the data. For safety this process should
// take place in three steps:
//
//    1. `./import-data download` to download the files
//    2. manual inspection of the downloaded files so that you don't blindly execute remote code
//    3. `./import-data generate` to produce `src/data/data.json`

const fs = require('fs');
const https = require('https');
const path = require('path');
const url = require('url');

//#region Data
const BattlePokemonIconIndexes = {
  // alt forms
  egg: 1020 + 1,
  pikachubelle: 1020 + 2,
  pikachulibre: 1020 + 3,
  pikachuphd: 1020 + 4,
  pikachupopstar: 1020 + 5,
  pikachurockstar: 1020 + 6,
  pikachucosplay: 1020 + 7,
  unownexclamation: 1020 + 8,
  unownquestion: 1020 + 9,
  unownb: 1020 + 10,
  unownc: 1020 + 11,
  unownd: 1020 + 12,
  unowne: 1020 + 13,
  unownf: 1020 + 14,
  unowng: 1020 + 15,
  unownh: 1020 + 16,
  unowni: 1020 + 17,
  unownj: 1020 + 18,
  unownk: 1020 + 19,
  unownl: 1020 + 20,
  unownm: 1020 + 21,
  unownn: 1020 + 22,
  unowno: 1020 + 23,
  unownp: 1020 + 24,
  unownq: 1020 + 25,
  unownr: 1020 + 26,
  unowns: 1020 + 27,
  unownt: 1020 + 28,
  unownu: 1020 + 29,
  unownv: 1020 + 30,
  unownw: 1020 + 31,
  unownx: 1020 + 32,
  unowny: 1020 + 33,
  unownz: 1020 + 34,
  castformrainy: 1020 + 35,
  castformsnowy: 1020 + 36,
  castformsunny: 1020 + 37,
  deoxysattack: 1020 + 38,
  deoxysdefense: 1020 + 39,
  deoxysspeed: 1020 + 40,
  burmysandy: 1020 + 41,
  burmytrash: 1020 + 42,
  wormadamsandy: 1020 + 43,
  wormadamtrash: 1020 + 44,
  cherrimsunshine: 1020 + 45,
  shelloseast: 1020 + 46,
  gastrodoneast: 1020 + 47,
  rotomfan: 1020 + 48,
  rotomfrost: 1020 + 49,
  rotomheat: 1020 + 50,
  rotommow: 1020 + 51,
  rotomwash: 1020 + 52,
  giratinaorigin: 1020 + 53,
  shayminsky: 1020 + 54,
  unfezantf: 1020 + 55,
  basculinbluestriped: 1020 + 56,
  darmanitanzen: 1020 + 57,
  deerlingautumn: 1020 + 58,
  deerlingsummer: 1020 + 59,
  deerlingwinter: 1020 + 60,
  sawsbuckautumn: 1020 + 61,
  sawsbucksummer: 1020 + 62,
  sawsbuckwinter: 1020 + 63,
  frillishf: 1020 + 64,
  jellicentf: 1020 + 65,
  tornadustherian: 1020 + 66,
  thundurustherian: 1020 + 67,
  landorustherian: 1020 + 68,
  kyuremblack: 1020 + 69,
  kyuremwhite: 1020 + 70,
  keldeoresolute: 1020 + 71,
  meloettapirouette: 1020 + 72,
  vivillonarchipelago: 1020 + 73,
  vivilloncontinental: 1020 + 74,
  vivillonelegant: 1020 + 75,
  vivillonfancy: 1020 + 76,
  vivillongarden: 1020 + 77,
  vivillonhighplains: 1020 + 78,
  vivillonicysnow: 1020 + 79,
  vivillonjungle: 1020 + 80,
  vivillonmarine: 1020 + 81,
  vivillonmodern: 1020 + 82,
  vivillonmonsoon: 1020 + 83,
  vivillonocean: 1020 + 84,
  vivillonpokeball: 1020 + 85,
  vivillonpolar: 1020 + 86,
  vivillonriver: 1020 + 87,
  vivillonsandstorm: 1020 + 88,
  vivillonsavanna: 1020 + 89,
  vivillonsun: 1020 + 90,
  vivillontundra: 1020 + 91,
  pyroarf: 1020 + 92,
  flabebeblue: 1020 + 93,
  flabebeorange: 1020 + 94,
  flabebewhite: 1020 + 95,
  flabebeyellow: 1020 + 96,
  floetteblue: 1020 + 97,
  floetteeternal: 1020 + 98,
  floetteorange: 1020 + 99,
  floettewhite: 1020 + 100,
  floetteyellow: 1020 + 101,
  florgesblue: 1020 + 102,
  florgesorange: 1020 + 103,
  florgeswhite: 1020 + 104,
  florgesyellow: 1020 + 105,
  furfroudandy: 1020 + 106,
  furfroudebutante: 1020 + 107,
  furfroudiamond: 1020 + 108,
  furfrouheart: 1020 + 109,
  furfroukabuki: 1020 + 110,
  furfroulareine: 1020 + 111,
  furfroumatron: 1020 + 112,
  furfroupharaoh: 1020 + 113,
  furfroustar: 1020 + 114,
  meowsticf: 1020 + 115,
  aegislashblade: 1020 + 116,
  xerneasneutral: 1020 + 117,
  hoopaunbound: 1020 + 118,
  rattataalola: 1020 + 119,
  raticatealola: 1020 + 120,
  raichualola: 1020 + 121,
  sandshrewalola: 1020 + 122,
  sandslashalola: 1020 + 123,
  vulpixalola: 1020 + 124,
  ninetalesalola: 1020 + 125,
  diglettalola: 1020 + 126,
  dugtrioalola: 1020 + 127,
  meowthalola: 1020 + 128,
  persianalola: 1020 + 129,
  geodudealola: 1020 + 130,
  graveleralola: 1020 + 131,
  golemalola: 1020 + 132,
  grimeralola: 1020 + 133,
  mukalola: 1020 + 134,
  exeggutoralola: 1020 + 135,
  marowakalola: 1020 + 136,
  greninjaash: 1020 + 137,
  zygarde10: 1020 + 138,
  zygardecomplete: 1020 + 139,
  oricoriopompom: 1020 + 140,
  oricoriopau: 1020 + 141,
  oricoriosensu: 1020 + 142,
  lycanrocmidnight: 1020 + 143,
  wishiwashischool: 1020 + 144,
  miniormeteor: 1020 + 145,
  miniororange: 1020 + 146,
  minioryellow: 1020 + 147,
  miniorgreen: 1020 + 148,
  miniorblue: 1020 + 149,
  miniorindigo: 1020 + 150,
  miniorviolet: 1020 + 151,
  magearnaoriginal: 1020 + 152,
  pikachuoriginal: 1020 + 153,
  pikachuhoenn: 1020 + 154,
  pikachusinnoh: 1020 + 155,
  pikachuunova: 1020 + 156,
  pikachukalos: 1020 + 157,
  pikachualola: 1020 + 158,
  pikachupartner: 1020 + 159,
  lycanrocdusk: 1020 + 160,
  necrozmaduskmane: 1020 + 161,
  necrozmadawnwings: 1020 + 162,
  necrozmaultra: 1020 + 163,
  pikachustarter: 1020 + 164,
  eeveestarter: 1020 + 165,
  meowthgalar: 1020 + 166,
  ponytagalar: 1020 + 167,
  rapidashgalar: 1020 + 168,
  farfetchdgalar: 1020 + 169,
  weezinggalar: 1020 + 170,
  mrmimegalar: 1020 + 171,
  corsolagalar: 1020 + 172,
  zigzagoongalar: 1020 + 173,
  linoonegalar: 1020 + 174,
  darumakagalar: 1020 + 175,
  darmanitangalar: 1020 + 176,
  darmanitangalarzen: 1020 + 177,
  yamaskgalar: 1020 + 178,
  stunfiskgalar: 1020 + 179,
  cramorantgulping: 1020 + 180,
  cramorantgorging: 1020 + 181,
  toxtricitylowkey: 1020 + 182,
  sinisteaantique: 854,
  polteageistantique: 855,
  alcremierubycream: 1020 + 183,
  alcremiematchacream: 1020 + 184,
  alcremiemintcream: 1020 + 185,
  alcremielemoncream: 1020 + 186,
  alcremiesaltedcream: 1020 + 187,
  alcremierubyswirl: 1020 + 188,
  alcremiecaramelswirl: 1020 + 189,
  alcremierainbowswirl: 1020 + 190,
  eiscuenoice: 1020 + 191,
  indeedeef: 1020 + 192,
  morpekohangry: 1020 + 193,
  zaciancrowned: 1020 + 194,
  zamazentacrowned: 1020 + 195,
  slowpokegalar: 1020 + 196,
  slowbrogalar: 1020 + 197,
  zarudedada: 1020 + 198,
  pikachuworld: 1020 + 199,
  articunogalar: 1020 + 200,
  zapdosgalar: 1020 + 201,
  moltresgalar: 1020 + 202,
  slowkinggalar: 1020 + 203,
  calyrexice: 1020 + 204,
  calyrexshadow: 1020 + 205,
  growlithehisui: 1020 + 206,
  arcaninehisui: 1020 + 207,
  voltorbhisui: 1020 + 208,
  electrodehisui: 1020 + 209,
  typhlosionhisui: 1020 + 210,
  qwilfishhisui: 1020 + 211,
  sneaselhisui: 1020 + 212,
  samurotthisui: 1020 + 213,
  lilliganthisui: 1020 + 214,
  zoruahisui: 1020 + 215,
  zoroarkhisui: 1020 + 216,
  braviaryhisui: 1020 + 217,
  sliggoohisui: 1020 + 218,
  goodrahisui: 1020 + 219,
  avalugghisui: 1020 + 220,
  decidueyehisui: 1020 + 221,
  basculegionf: 1020 + 222,
  enamorustherian: 1020 + 223,
  taurospaldea: 1020 + 224,
  taurospaldeafire: 1020 + 225,
  taurospaldeawater: 1020 + 226,
  taurospaldeacombat: 1020 + 224,
  taurospaldeablaze: 1020 + 225,
  taurospaldeaaqua: 1020 + 226,
  wooperpaldea: 1020 + 227,
  oinkolognef: 1020 + 228,
  palafinhero: 1020 + 229,
  mausholdfour: 1020 + 230,
  tatsugiridroopy: 1020 + 231,
  tatsugiristretchy: 1020 + 232,
  squawkabillyblue: 1020 + 233,
  squawkabillyyellow: 1020 + 234,
  squawkabillywhite: 1020 + 235,
  gimmighoulroaming: 1020 + 236,
  dialgaorigin: 1020 + 237,
  palkiaorigin: 1020 + 238,
  basculinwhitestriped: 1020 + 239,
  ursalunabloodmoon: 1020 + 240,
  ogerponwellspring: 1020 + 241,
  ogerponhearthflame: 1020 + 242,
  ogerponcornerstone: 1020 + 243,

  // alt forms with duplicate icons
  greninjabond: 658,
  gumshoostotem: 735,
  raticatealolatotem: 1020 + 120,
  marowakalolatotem: 1020 + 136,
  araquanidtotem: 752,
  lurantistotem: 754,
  salazzletotem: 758,
  ribombeetotem: 743,
  kommoototem: 784,
  sinisteaantique: 854,
  polteageistantique: 855,
  poltchageistartisan: 1012,
  sinistchamasterpiece: 1013,
  ogerpontealtera: 1017,
  ogerponwellspringtera: 1020 + 241,
  ogerponhearthflametera: 1020 + 242,
  ogerponcornerstonetera: 1020 + 243,

  // Mega/G-Max
  venusaurmega: 1272 + 0,
  charizardmegax: 1272 + 1,
  charizardmegay: 1272 + 2,
  blastoisemega: 1272 + 3,
  beedrillmega: 1272 + 4,
  pidgeotmega: 1272 + 5,
  alakazammega: 1272 + 6,
  slowbromega: 1272 + 7,
  gengarmega: 1272 + 8,
  kangaskhanmega: 1272 + 9,
  pinsirmega: 1272 + 10,
  gyaradosmega: 1272 + 11,
  aerodactylmega: 1272 + 12,
  mewtwomegax: 1272 + 13,
  mewtwomegay: 1272 + 14,
  ampharosmega: 1272 + 15,
  steelixmega: 1272 + 16,
  scizormega: 1272 + 17,
  heracrossmega: 1272 + 18,
  houndoommega: 1272 + 19,
  tyranitarmega: 1272 + 20,
  sceptilemega: 1272 + 21,
  blazikenmega: 1272 + 22,
  swampertmega: 1272 + 23,
  gardevoirmega: 1272 + 24,
  sableyemega: 1272 + 25,
  mawilemega: 1272 + 26,
  aggronmega: 1272 + 27,
  medichammega: 1272 + 28,
  manectricmega: 1272 + 29,
  sharpedomega: 1272 + 30,
  cameruptmega: 1272 + 31,
  altariamega: 1272 + 32,
  banettemega: 1272 + 33,
  absolmega: 1272 + 34,
  glaliemega: 1272 + 35,
  salamencemega: 1272 + 36,
  metagrossmega: 1272 + 37,
  latiasmega: 1272 + 38,
  latiosmega: 1272 + 39,
  kyogreprimal: 1272 + 40,
  groudonprimal: 1272 + 41,
  rayquazamega: 1272 + 42,
  lopunnymega: 1272 + 43,
  garchompmega: 1272 + 44,
  lucariomega: 1272 + 45,
  abomasnowmega: 1272 + 46,
  gallademega: 1272 + 47,
  audinomega: 1272 + 48,
  dianciemega: 1272 + 49,
  charizardgmax: 1272 + 50,
  butterfreegmax: 1272 + 51,
  pikachugmax: 1272 + 52,
  meowthgmax: 1272 + 53,
  machampgmax: 1272 + 54,
  gengargmax: 1272 + 55,
  kinglergmax: 1272 + 56,
  laprasgmax: 1272 + 57,
  eeveegmax: 1272 + 58,
  snorlaxgmax: 1272 + 59,
  garbodorgmax: 1272 + 60,
  melmetalgmax: 1272 + 61,
  corviknightgmax: 1272 + 62,
  orbeetlegmax: 1272 + 63,
  drednawgmax: 1272 + 64,
  coalossalgmax: 1272 + 65,
  flapplegmax: 1272 + 66,
  appletungmax: 1272 + 67,
  sandacondagmax: 1272 + 68,
  toxtricitygmax: 1272 + 69,
  toxtricitylowkeygmax: 1272 + 69,
  centiskorchgmax: 1272 + 70,
  hatterenegmax: 1272 + 71,
  grimmsnarlgmax: 1272 + 72,
  alcremiegmax: 1272 + 73,
  copperajahgmax: 1272 + 74,
  duraludongmax: 1272 + 75,
  eternatuseternamax: 1272 + 76,
  venusaurgmax: 1272 + 77,
  blastoisegmax: 1272 + 78,
  rillaboomgmax: 1272 + 79,
  cinderacegmax: 1272 + 80,
  inteleongmax: 1272 + 81,
  urshifugmax: 1272 + 82,
  urshifurapidstrikegmax: 1272 + 83,

  // CAP
  syclant: 1464 + 0,
  revenankh: 1464 + 1,
  pyroak: 1464 + 2,
  fidgit: 1464 + 3,
  stratagem: 1464 + 4,
  arghonaut: 1464 + 5,
  kitsunoh: 1464 + 6,
  cyclohm: 1464 + 7,
  colossoil: 1464 + 8,
  krilowatt: 1464 + 9,
  voodoom: 1464 + 10,
  tomohawk: 1464 + 11,
  necturna: 1464 + 12,
  mollux: 1464 + 13,
  aurumoth: 1464 + 14,
  malaconda: 1464 + 15,
  cawmodore: 1464 + 16,
  volkraken: 1464 + 17,
  plasmanta: 1464 + 18,
  naviathan: 1464 + 19,
  crucibelle: 1464 + 20,
  crucibellemega: 1464 + 21,
  kerfluffle: 1464 + 22,
  pajantom: 1464 + 23,
  jumbao: 1464 + 24,
  caribolt: 1464 + 25,
  smokomodo: 1464 + 26,
  snaelstrom: 1464 + 27,
  equilibra: 1464 + 28,
  astrolotl: 1464 + 29,
  miasmaw: 1464 + 30,
  chromera: 1464 + 31,
  venomicon: 1464 + 32,
  venomiconepilogue: 1464 + 33,
  saharaja: 1464 + 34,
  hemogoblin: 1464 + 35,

  // CAP prevos
  syclar: 1500 + 0,
  embirch: 1500 + 1,
  flarelm: 1500 + 2,
  breezi: 1500 + 3,
  scratchet: 1500 + 4,
  necturine: 1500 + 5,
  cupra: 1500 + 6,
  argalis: 1500 + 7,
  brattler: 1500 + 8,
  cawdet: 1500 + 9,
  volkritter: 1500 + 10,
  snugglow: 1500 + 11,
  floatoy: 1500 + 12,
  caimanoe: 1500 + 13,
  pluffle: 1500 + 14,
  rebble: 1500 + 15,
  tactite: 1500 + 16,
  privatyke: 1500 + 17,
  nohface: 1500 + 18,
  monohm: 1500 + 19,
  duohm: 1500 + 20,
  protowatt: 1500 + 21,
  voodoll: 1500 + 22,
  mumbao: 1500 + 23,
  fawnifer: 1500 + 24,
  electrelk: 1500 + 25,
  smogecko: 1500 + 26,
  smoguana: 1500 + 27,
  swirlpool: 1500 + 28,
  coribalis: 1500 + 29,
  justyke: 1500 + 30,
  solotl: 1500 + 31,
  miasmite: 1500 + 32,
  dorsoil: 1500 + 33,
  saharascal: 1500 + 34,
  ababo: 1500 + 35,
  scattervein: 1500 + 36,
};

const BattlePokemonIconIndexesLeft = {
  pikachubelle: 1356 + 0,
  pikachupopstar: 1356 + 1,
  clefairy: 1356 + 2,
  clefable: 1356 + 3,
  jigglypuff: 1356 + 4,
  wigglytuff: 1356 + 5,
  dugtrioalola: 1356 + 6,
  poliwhirl: 1356 + 7,
  poliwrath: 1356 + 8,
  mukalola: 1356 + 9,
  kingler: 1356 + 10,
  croconaw: 1356 + 11,
  cleffa: 1356 + 12,
  igglybuff: 1356 + 13,
  politoed: 1356 + 14,
  unownb: 1356 + 15,
  unownc: 1356 + 16,
  unownd: 1356 + 17,
  unowne: 1356 + 18,
  unownf: 1356 + 19,
  unowng: 1356 + 20,
  unownh: 1356 + 21,
  unownj: 1356 + 22,
  unownk: 1356 + 23,
  unownl: 1356 + 24,
  unownm: 1356 + 25,
  unownn: 1356 + 26,
  unownp: 1356 + 27,
  unownq: 1356 + 28,
  unownquestion: 1356 + 29,
  unownr: 1356 + 30,
  unowns: 1356 + 31,
  unownt: 1356 + 32,
  unownv: 1356 + 33,
  unownz: 1356 + 34,
  sneasel: 1356 + 35,
  teddiursa: 1356 + 36,
  roselia: 1356 + 37,
  zangoose: 1356 + 38,
  seviper: 1356 + 39,
  castformsnowy: 1356 + 40,
  absolmega: 1356 + 41,
  absol: 1356 + 42,
  regirock: 1356 + 43,
  torterra: 1356 + 44,
  budew: 1356 + 45,
  roserade: 1356 + 46,
  magmortar: 1356 + 47,
  togekiss: 1356 + 48,
  rotomwash: 1356 + 49,
  shayminsky: 1356 + 50,
  emboar: 1356 + 51,
  pansear: 1356 + 52,
  simisear: 1356 + 53,
  drilbur: 1356 + 54,
  excadrill: 1356 + 55,
  sawk: 1356 + 56,
  lilligant: 1356 + 57,
  garbodor: 1356 + 58,
  solosis: 1356 + 59,
  vanilluxe: 1356 + 60,
  amoonguss: 1356 + 61,
  klink: 1356 + 62,
  klang: 1356 + 63,
  klinklang: 1356 + 64,
  litwick: 1356 + 65,
  golett: 1356 + 66,
  golurk: 1356 + 67,
  kyuremblack: 1356 + 68,
  kyuremwhite: 1356 + 69,
  kyurem: 1356 + 70,
  keldeoresolute: 1356 + 71,
  meloetta: 1356 + 72,
  greninja: 1356 + 73,
  greninjabond: 1356 + 73,
  greninjaash: 1356 + 74,
  furfroudebutante: 1356 + 75,
  barbaracle: 1356 + 76,
  clauncher: 1356 + 77,
  clawitzer: 1356 + 78,
  sylveon: 1356 + 79,
  klefki: 1356 + 80,
  zygarde: 1356 + 81,
  zygarde10: 1356 + 82,
  zygardecomplete: 1356 + 83,
  dartrix: 1356 + 84,
  steenee: 1356 + 85,
  tsareena: 1356 + 86,
  comfey: 1356 + 87,
  miniormeteor: 1356 + 88,
  minior: 1356 + 89,
  miniororange: 1356 + 90,
  minioryellow: 1356 + 91,
  miniorgreen: 1356 + 92,
  miniorblue: 1356 + 93,
  miniorviolet: 1356 + 94,
  miniorindigo: 1356 + 95,
  dhelmise: 1356 + 96,
  necrozma: 1356 + 97,
  marshadow: 1356 + 98,
  pikachuoriginal: 1356 + 99,
  pikachupartner: 1356 + 100,
  necrozmaduskmane: 1356 + 101,
  necrozmadawnwings: 1356 + 102,
  necrozmaultra: 1356 + 103,
  stakataka: 1356 + 104,
  blacephalon: 1356 + 105,
};

const BattleAvatarNumbers = {
  1: 'lucas',
  2: 'dawn',
  3: 'youngster-gen4dp',
  4: 'lass-gen4dp',
  5: 'camper',
  6: 'picnicker',
  7: 'bugcatcher-gen4dp',
  8: 'aromalady',
  9: 'twins-gen4dp',
  10: 'hiker-gen4',
  11: 'battlegirl-gen4',
  12: 'fisherman-gen4',
  13: 'cyclist-gen4',
  14: 'cyclistf-gen4',
  15: 'blackbelt-gen4dp',
  16: 'artist-gen4',
  17: 'pokemonbreeder-gen4',
  18: 'pokemonbreederf-gen4',
  19: 'cowgirl',
  20: 'jogger',
  21: 'pokefan-gen4',
  22: 'pokefanf-gen4',
  23: 'pokekid',
  24: 'youngcouple-gen4dp',
  25: 'acetrainer-gen4dp',
  26: 'acetrainerf-gen4dp',
  27: 'waitress-gen4',
  28: 'veteran-gen4',
  29: 'ninjaboy',
  30: 'dragontamer',
  31: 'birdkeeper-gen4dp',
  32: 'doubleteam',
  33: 'richboy-gen4',
  34: 'lady-gen4',
  35: 'gentleman-gen4dp',
  36: 'madame-gen4dp',
  37: 'beauty-gen4dp',
  38: 'collector',
  39: 'policeman-gen4',
  40: 'pokemonranger-gen4',
  41: 'pokemonrangerf-gen4',
  42: 'scientist-gen4dp',
  43: 'swimmer-gen4dp',
  44: 'swimmerf-gen4dp',
  45: 'tuber',
  46: 'tuberf',
  47: 'sailor',
  48: 'sisandbro',
  49: 'ruinmaniac',
  50: 'psychic-gen4',
  51: 'psychicf-gen4',
  52: 'gambler',
  53: 'guitarist-gen4',
  54: 'acetrainersnow',
  55: 'acetrainersnowf',
  56: 'skier',
  57: 'skierf-gen4dp',
  58: 'roughneck-gen4',
  59: 'clown',
  60: 'worker-gen4',
  61: 'schoolkid-gen4dp',
  62: 'schoolkidf-gen4',
  63: 'roark',
  64: 'barry',
  65: 'byron',
  66: 'aaron',
  67: 'bertha',
  68: 'flint',
  69: 'lucian',
  70: 'cynthia-gen4',
  71: 'bellepa',
  72: 'rancher',
  73: 'mars',
  74: 'galacticgrunt',
  75: 'gardenia',
  76: 'crasherwake',
  77: 'maylene',
  78: 'fantina',
  79: 'candice',
  80: 'volkner',
  81: 'parasollady-gen4',
  82: 'waiter-gen4dp',
  83: 'interviewers',
  84: 'cameraman',
  85: 'reporter',
  86: 'idol',
  87: 'cyrus',
  88: 'jupiter',
  89: 'saturn',
  90: 'galacticgruntf',
  91: 'argenta',
  92: 'palmer',
  93: 'thorton',
  94: 'buck',
  95: 'darach',
  96: 'marley',
  97: 'mira',
  98: 'cheryl',
  99: 'riley',
  100: 'dahlia',
  101: 'ethan',
  102: 'lyra',
  103: 'twins-gen4',
  104: 'lass-gen4',
  105: 'acetrainer-gen4',
  106: 'acetrainerf-gen4',
  107: 'juggler',
  108: 'sage',
  109: 'li',
  110: 'gentleman-gen4',
  111: 'teacher',
  112: 'beauty',
  113: 'birdkeeper',
  114: 'swimmer-gen4',
  115: 'swimmerf-gen4',
  116: 'kimonogirl',
  117: 'scientist-gen4',
  118: 'acetrainercouple',
  119: 'youngcouple',
  120: 'supernerd',
  121: 'medium',
  122: 'schoolkid-gen4',
  123: 'blackbelt-gen4',
  124: 'pokemaniac',
  125: 'firebreather',
  126: 'burglar',
  127: 'biker-gen4',
  128: 'skierf',
  129: 'boarder',
  130: 'rocketgrunt',
  131: 'rocketgruntf',
  132: 'archer',
  133: 'ariana',
  134: 'proton',
  135: 'petrel',
  136: 'eusine',
  137: 'lucas-gen4pt',
  138: 'dawn-gen4pt',
  139: 'madame-gen4',
  140: 'waiter-gen4',
  141: 'falkner',
  142: 'bugsy',
  143: 'whitney',
  144: 'morty',
  145: 'chuck',
  146: 'jasmine',
  147: 'pryce',
  148: 'clair',
  149: 'will',
  150: 'koga',
  151: 'bruno',
  152: 'karen',
  153: 'lance',
  154: 'brock',
  155: 'misty',
  156: 'ltsurge',
  157: 'erika',
  158: 'janine',
  159: 'sabrina',
  160: 'blaine',
  161: 'blue',
  162: 'red',
  163: 'red',
  164: 'silver',
  165: 'giovanni',
  166: 'unknownf',
  167: 'unknown',
  168: 'unknown',
  169: 'hilbert',
  170: 'hilda',
  171: 'youngster',
  172: 'lass',
  173: 'schoolkid',
  174: 'schoolkidf',
  175: 'smasher',
  176: 'linebacker',
  177: 'waiter',
  178: 'waitress',
  179: 'chili',
  180: 'cilan',
  181: 'cress',
  182: 'nurseryaide',
  183: 'preschoolerf',
  184: 'preschooler',
  185: 'twins',
  186: 'pokemonbreeder',
  187: 'pokemonbreederf',
  188: 'lenora',
  189: 'burgh',
  190: 'elesa',
  191: 'clay',
  192: 'skyla',
  193: 'pokemonranger',
  194: 'pokemonrangerf',
  195: 'worker',
  196: 'backpacker',
  197: 'backpackerf',
  198: 'fisherman',
  199: 'musician',
  200: 'dancer',
  201: 'harlequin',
  202: 'artist',
  203: 'baker',
  204: 'psychic',
  205: 'psychicf',
  206: 'cheren',
  207: 'bianca',
  208: 'plasmagrunt-gen5bw',
  209: 'n',
  210: 'richboy',
  211: 'lady',
  212: 'pilot',
  213: 'workerice',
  214: 'hoopster',
  215: 'scientistf',
  216: 'clerkf',
  217: 'acetrainerf',
  218: 'acetrainer',
  219: 'blackbelt',
  220: 'scientist',
  221: 'striker',
  222: 'brycen',
  223: 'iris',
  224: 'drayden',
  225: 'roughneck',
  226: 'janitor',
  227: 'pokefan',
  228: 'pokefanf',
  229: 'doctor',
  230: 'nurse',
  231: 'hooligans',
  232: 'battlegirl',
  233: 'parasollady',
  234: 'clerk',
  235: 'clerk-boss',
  236: 'backers',
  237: 'backersf',
  238: 'veteran',
  239: 'veteranf',
  240: 'biker',
  241: 'infielder',
  242: 'hiker',
  243: 'madame',
  244: 'gentleman',
  245: 'plasmagruntf-gen5bw',
  246: 'shauntal',
  247: 'marshal',
  248: 'grimsley',
  249: 'caitlin',
  250: 'ghetsis-gen5bw',
  251: 'depotagent',
  252: 'swimmer',
  253: 'swimmerf',
  254: 'policeman',
  255: 'maid',
  256: 'ingo',
  257: 'alder',
  258: 'cyclist',
  259: 'cyclistf',
  260: 'cynthia',
  261: 'emmet',
  262: 'hilbert-wonderlauncher',
  263: 'hilda-wonderlauncher',
  264: 'hugh',
  265: 'rosa',
  266: 'nate',
  267: 'colress',
  268: 'beauty-gen5bw2',
  269: 'ghetsis',
  270: 'plasmagrunt',
  271: 'plasmagruntf',
  272: 'iris-gen5bw2',
  273: 'brycenman',
  274: 'shadowtriad',
  275: 'rood',
  276: 'zinzolin',
  277: 'cheren-gen5bw2',
  278: 'marlon',
  279: 'roxie',
  280: 'roxanne',
  281: 'brawly',
  282: 'wattson',
  283: 'flannery',
  284: 'norman',
  285: 'winona',
  286: 'tate',
  287: 'liza',
  288: 'juan',
  289: 'guitarist',
  290: 'steven',
  291: 'wallace',
  292: 'bellelba',
  293: 'benga',
  294: 'ash',
  '#bw2elesa': 'elesa-gen5bw2',
  '#teamrocket': 'teamrocket',
  '#yellow': 'yellow',
  '#zinnia': 'zinnia',
  '#clemont': 'clemont',
  '#wally': 'wally',
  breeder: 'pokemonbreeder',
  breederf: 'pokemonbreederf',
  'hilbert-dueldisk': 'hilbert-wonderlauncher',
  'hilda-dueldisk': 'hilda-wonderlauncher',
  'nate-dueldisk': 'nate-wonderlauncher',
  'rosa-dueldisk': 'rosa-wonderlauncher',
  1001: '#1001',
  1002: '#1002',
  1003: '#1003',
  1005: '#1005',
  1010: '#1010',
};

const DEX = new Set([
  "pikachustarter", "eeveestarter", "meltan", "melmetal", "fidgit", "stratagem", "tomohawk",
  "mollux", "crucibelle", "crucibellemega", "kerfluffle", "pajantom", "jumbao", "caribolt",
  "smokomodo", "snaelstrom", "equilibra", "scratchet", "pluffle", "smogecko", "pokestarufo",
  "pokestarufo2", "pokestarbrycenman", "pokestarmt", "pokestarmt2", "pokestargiant",
  "pokestarhumanoid", "pokestarmonster", "pokestarf00", "pokestarf002", "pokestarspirit",
]);

const NODEX = new Set([
  'pikachulibre', 'pikachuphd', 'pikachupopstar', 'pikachubelle', 'pikachurockstar',
]);

// FIXME: ideally this list should be unnecesary and shiny sprites would be added
const MISSING = {
  chesnaught: ['gen5ani-shiny', 'gen5ani-back-shiny'],
  corviknight: ['gen5ani-shiny'],
  drednaw: ['gen5ani-shiny'],
  drednawgmax: ['gen5ani-shiny'],
  duraludon: ['gen5ani-shiny'],
  grookey: ['gen5ani-shiny'],
  hatenna: ['gen5ani-shiny'],
  meowthgalar: ['gen5ani-shiny'],
  meowthgmax: ['gen5ani-shiny'],
  milcery: ['gen5ani-shiny'],
  noivern: ['gen5ani-shiny'],
  rookidee: ['gen5ani-shiny'],
  scorbunny: ['gen5ani-shiny'],
  snom: ['gen5ani-shiny'],
  sobble: ['gen5ani-shiny'],
  toxel: ['gen5ani-shiny'],
  wooloo: ['gen5ani-shiny', 'gen5ani-back-shiny'],
  yamper: ['gen5ani-shiny', 'gen5ani-back-shiny'],
};

// Certain Pokemon can be hacked to be shiny and will be considered 'shiny' without change of sprite
// Research from Anubis: https://twitter.com/Sibuna_Switch/status/1246865031431516162
const NONSHINY = new Set([
  'pikachuoriginal',
  // Probably safe to assume they follow the same rules as Pikachu-Original
  'pikachuhoenn', 'pikachusinnoh', 'pikachuunova', 'pikachukalos', 'pikachualola',
  // Gen 1 only so clearly can't be shiny
  'missingno',
  // TODO: verify Pokestar also falls under this category
  'pokestarsmeargle', 'pokestarufo', 'pokestarufo2', 'pokestarbrycenman', 'pokestarmt',
  'pokestarmt2', 'pokestartransport', 'pokestargiant', 'pokestarhumanoid', 'pokestarmonster',
  'pokestarf00', 'pokestarf002', 'pokestarspirit', 'pokestarblackdoor', 'pokestarwhitedoor',
  'pokestarblackbelt',
]);

//#endregion
//#region Main

const toID = s => ('' + s).toLowerCase().replace(/[^a-z0-9]+/g, '');

function fetch(u) {
  return new Promise((resolve, reject) => {
    let data = '';
    const req = https.get(u, res => {
      if (res.statusCode !== 200) {
        if (res.statusCode >= 300 && res.statusCode <= 400 && res.headers.location) {
          return resolve(fetch(url.resolve(u, res.headers.location)));
        } else {
          return reject(new Error(`HTTP ${res.statusCode}`));
        }
      }
      res.on('data', d => {
        data += d;
      });
      res.on('end', () => resolve(data));
    });
    req.on('error', reject);
    req.end();
  });
}

(async () => {
  const dir = path.resolve(__dirname, 'data');
  if (!fs.existsSync(dir)) fs.mkdirSync(dir);
  if (process.argv[2] !== 'generate') {
    fs.writeFileSync(path.join(dir, 'pokedex-mini.js'),
      await fetch('https://play.pokemonshowdown.com/data/pokedex-mini.js'));
    fs.writeFileSync(path.join(dir, 'pokedex-mini-bw.js'),
      await fetch('https://play.pokemonshowdown.com/data/pokedex-mini-bw.js'));
  }
  if (process.argv[2] === 'download') process.exit(0);

  const BattlePokemonSprites = require('./data/pokedex-mini').BattlePokemonSprites;
  const BattlePokemonSpritesBW = require('./data/pokedex-mini-bw').BattlePokemonSpritesBW;

  const data = {};

  // we expect this to have been built...
  const Dex = require('../vendor/pokemon-showdown/dist/sim/dex.js').Dex;

  // Reverse map from spriteid as calculated by `build-minidex` to [Species, sprite-id]
  const SPECIES = {};
  const index = [];
  for (const baseid in Dex.data.Pokedex) {
    const species = Dex.species.get(baseid);
    for (const formeid of [species.id].concat(species.cosmeticFormes || []).map(toID)) {
      const baseid = toID(species.baseSpecies);
      let spriteid;
      if (species.baseSpecies === 'FlabeÃÅbeÃÅ') {
        spriteid = formeid === 'flabebe' ? formeid : `flabebe-${formeid.slice(7)}`;
      } else {
        spriteid = formeid === baseid
          ? baseid
          : `${baseid}-${formeid.slice(baseid.length)}`;
      }
      const id = toID(spriteid);
      SPECIES[id] = [species, spriteid];
      // Totems have no visual difference other than size, which is handled during rendering
      if (!id.endsWith('totem')) {
        index.push([species, `${Dex.species.get(formeid).name}${species.gender ? '' : '*'}`]);
      }
    }
  }

  const sorted = index.sort(([a,], [b,]) => {
    if (a.gen - b.gen) return a.gen - b.gen;
    return Math.abs(a.num) - Math.abs(b.num);
  });

  const names = [];
  const offsets = [];
  let gen = 0;
  let offset = 0;
  for (const [species, name] of sorted) {
    names.push(name);
    if (!species.isNonstandard && species.gen === gen + 1) {
      offsets.push(offset);
      gen++;
    }
    offset++;
  }

  fs.writeFileSync(
    path.join(dir, 'index.js'),
    `const SPECIES = ${JSON.stringify(names)};\nconst OFFSETS = ${JSON.stringify(offsets)};\n`
  );

  data.pokemon = {};
  for (const id in BattlePokemonSprites) {
    const sprite = BattlePokemonSprites[id];
    const bwSprite = BattlePokemonSpritesBW[id];
    if (sprite.exists === false) continue;

    const s = data.pokemon[id] = {n: sprite.num};

    if (BattlePokemonIconIndexes[id] !== s.n) s.i = BattlePokemonIconIndexes[id];
    if (BattlePokemonIconIndexes[`${id}f`]) s.if = BattlePokemonIconIndexes[`${id}f`];
    if (BattlePokemonIconIndexesLeft[id]) s.il = BattlePokemonIconIndexesLeft[id];

    if (sprite.front) s.f = sprite.front;
    if (sprite.frontf) s.ff = sprite.frontf;
    if (sprite.back) s.b = sprite.back;
    if (sprite.backf) s.bf = sprite.backf;

    if (bwSprite && (bwSprite.front || bwSprite.frontf || bwSprite.back || bwSprite.backf)) {
      s.bw = {};
      if (bwSprite.front) s.bw.f = bwSprite.front;
      if (bwSprite.frontf) s.bw.ff = bwSprite.frontf;
      if (bwSprite.back) s.bw.b = bwSprite.back;
      if (bwSprite.backf) s.bw.bf = bwSprite.backf;
    }

    const [species, spriteid] = SPECIES[id];
    s.g = species.gen;
    if (id !== spriteid) s.s = spriteid.indexOf('-');
    const dex =
      (!species.isNonstandard || ['Unobtainable', 'Past'].includes(species.isNonstandard)) ||
      DEX.has(species.id);
    if (!dex || NODEX.has(species.id)) s.nd = true;
    if (MISSING[id]) s.m = MISSING[id];
    if (NONSHINY.has(species.id)) s.ns = true;
  }

  data.items = {};
  for (const item in Dex.data.Items) {
    const spritenum = Dex.items.get(item).spritenum;
    if (spritenum) data.items[item] = spritenum;
  }

  data.avatars = BattleAvatarNumbers;

  fs.writeFileSync(path.resolve(__dirname, 'src/data/data.json'), JSON.stringify(data));
})();

//#endregion
